(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{428:function(s,t,a){"use strict";a.r(t);var n=a(2),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"commonjs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#commonjs"}},[s._v("#")]),s._v(" CommonJS")]),s._v(" "),t("p",[s._v("在 nodejs 中，由于有且仅有一个入口文件（启动文件），而开发一个应用肯定会涉及到多个文件配合，因此，nodejs 对模块化的需求比浏览器端要大的多")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://imgse.com/i/pPlPa59",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://s1.ax1x.com/2023/08/16/pPlPa59.md.png",alt:"pPlPa59.md.png"}}),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("由于 nodejs 刚刚发布的时候，前端没有统一的、官方的模块化规范，因此，它选择使用社区提供的 CommonJS 作为模块化规范")]),s._v(" "),t("p",[s._v("在学习 CommonJS 之前，首先认识两个重要的概念："),t("strong",[s._v("模块的导出")]),s._v("和"),t("strong",[s._v("模块的导入")])]),s._v(" "),t("h2",{attrs:{id:"模块的导出"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#模块的导出"}},[s._v("#")]),s._v(" 模块的导出")]),s._v(" "),t("p",[s._v("要理解模块的导出，首先要理解模块的含义")]),s._v(" "),t("p",[s._v("什么是模块？")]),s._v(" "),t("p",[s._v("模块就是一个 JS 文件，它实现了一部分功能，并隐藏自己的内部实现，同时提供了一些接口供其他模块使用")]),s._v(" "),t("p",[s._v("模块有两个核心要素："),t("strong",[s._v("隐藏")]),s._v("和"),t("strong",[s._v("暴露")])]),s._v(" "),t("p",[s._v("隐藏的，是自己内部的实现")]),s._v(" "),t("p",[s._v("暴露的，是希望外部使用的接口")]),s._v(" "),t("p",[s._v("任何一个正常的模块化标准，都应该默认隐藏模块中的所有实现，而通过一些语法或 api 调用来暴露接口")]),s._v(" "),t("p",[t("strong",[s._v("暴露接口的过程即模块的导出")])]),s._v(" "),t("p",[t("a",{attrs:{href:"https://imgse.com/i/pPlPBgx",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://s1.ax1x.com/2023/08/16/pPlPBgx.png",alt:"pPlPBgx.png"}}),t("OutboundLink")],1)]),s._v(" "),t("h2",{attrs:{id:"模块的导入"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#模块的导入"}},[s._v("#")]),s._v(" 模块的导入")]),s._v(" "),t("p",[s._v("当需要使用一个模块时，使用的是该模块暴露的部分（导出的部分），隐藏的部分是永远无法使用的。")]),s._v(" "),t("p",[t("strong",[s._v("当通过某种语法或 api 去使用一个模块时，这个过程叫做模块的导入")])]),s._v(" "),t("h2",{attrs:{id:"commonjs-规范"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#commonjs-规范"}},[s._v("#")]),s._v(" CommonJS 规范")]),s._v(" "),t("p",[s._v("CommonJS 使用"),t("code",[s._v("exports")]),s._v("导出模块，"),t("code",[s._v("require")]),s._v("导入模块")]),s._v(" "),t("p",[s._v("具体规范如下：")]),s._v(" "),t("ol",[t("li",[s._v("如果一个 JS 文件中存在"),t("code",[s._v("exports")]),s._v("或"),t("code",[s._v("require")]),s._v("，该 JS 文件是一个模块")]),s._v(" "),t("li",[s._v("模块内的所有代码均为隐藏代码，包括全局变量、全局函数，这些全局的内容均不应该对全局变量造成任何污染")]),s._v(" "),t("li",[s._v("如果一个模块需要暴露一些 API 提供给外部使用，需要通过"),t("code",[s._v("exports")]),s._v("导出，"),t("code",[s._v("exports")]),s._v("是一个空的对象，你可以为该对象添加任何需要导出的内容")]),s._v(" "),t("li",[s._v("如果一个模块需要导入其他模块，通过"),t("code",[s._v("require")]),s._v("实现，"),t("code",[s._v("require")]),s._v("是一个函数，传入模块的路径即可返回该模块导出的整个内容")])]),s._v(" "),t("h2",{attrs:{id:"nodejs-对-commonjs-的实现"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nodejs-对-commonjs-的实现"}},[s._v("#")]),s._v(" nodejs 对 CommonJS 的实现")]),s._v(" "),t("p",[s._v("为了实现 CommonJS 规范，nodejs 对模块做出了以下处理")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("为了保证高效的执行，仅加载必要的模块。nodejs 只有执行到"),t("code",[s._v("require")]),s._v("函数时才会加载并执行模块")])]),s._v(" "),t("li",[t("p",[s._v("为了隐藏模块中的代码，nodejs 执行模块时，会将模块中的所有代码放置到一个函数中执行，以保证不污染全局变量。")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//模块中的代码")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("为了保证顺利的导出模块内容，nodejs 做了以下处理")]),s._v(" "),t("ol",[t("li",[s._v("在模块开始执行前，初始化一个值"),t("code",[s._v("module.exports = {}")])]),s._v(" "),t("li",[t("code",[s._v("module.exports")]),s._v("即模块的导出值")]),s._v(" "),t("li",[s._v("为了方便开发者便捷的导出，nodejs 在初始化完"),t("code",[s._v("module.exports")]),s._v("后，又声明了一个变量"),t("code",[s._v("exports = module.exports")])])]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("module")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//模块中的代码")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("为了避免反复加载同一个模块，nodejs 默认开启了模块缓存，如果加载的模块已经被加载过了，则会自动使用之前的导出结果")])])])])}),[],!1,null,null,null);t.default=e.exports}}]);